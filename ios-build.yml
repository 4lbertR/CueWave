name: Build iOS App

on:
  workflow_dispatch:

jobs:
  build-ios:
    runs-on: macos-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Install dependencies
      run: npm install

    - name: Build web app
      run: npm run build

    - name: Copy web assets to iOS project
      run: npx cap copy ios

    - name: Install CocoaPods dependencies
      run: |
        cd ios/App
        pod install

    - name: Build iOS app (Xcode)
      run: |
        cd ios
        xcodebuild -workspace App/App.xcworkspace -scheme App -configuration Release -sdk iphoneos

    # OPTIONAL: Archive app for App Store/TestFlight
    # - name: Archive iOS app
    #   run: |
    #     cd ios
    #     xcodebuild -workspace App/App.xcworkspace -scheme App -configuration Release -sdk iphoneos -archivePath App.xcarchive archive

    # You need signing info for actual deployment (see below)